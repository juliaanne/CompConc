#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <pthread.h>
//#include "time.h"
#include <math.h>

double valorReal = 0.804776; // de 0 a 2

double calcula_funcao(double x){
	return sin(x*x);
}

double calcula_integral(double a, double b, double erroMaximo, int nparticoes){
	int i;
	double integral=0;
	double intervalo= ((b-a)/nparticoes);
	double aDavez = a;
	printf("a:%f ,b:%f\n",a,b );
	printf("intervalo %f\n", intervalo );
	printf("Aqui entrarei no for,iteraçao %d:\n", nparticoes);
	for(i=0; i<nparticoes; i++){
		integral += intervalo * calcula_funcao((aDavez + (aDavez+intervalo))/2);
		printf("Somatorio: %f, i: %d,intervalo: %f, a:%f\n", integral,i,intervalo,aDavez);
		aDavez+=intervalo;
	}
	printf("Aqui sairei do for,iteraçao %d:\n\n" ,nparticoes);
	sleep(1);
	double erro = fabs(valorReal-integral);

	if(erro >erroMaximo){
		printf("NParticoes: %d\n", nparticoes);
		printf("Erro da vez: %f\n", erro);
		printf("Somatorio: %f\n\n\n", integral);
		calcula_integral(a, b, erroMaximo, nparticoes*2);
	}

	return integral;
}

	

int main(int argc, char *argv[]){
	double a, b, erroMaximo,valor;
	
	//Validando os argumentos da entrada.
	if(argc<4){
		printf("Use %s <limite inferior> <limite superior> <erro máximo>", argv[0]);
		exit(EXIT_FAILURE);
	}
	
	//Recebendo os argumentos da entrada.
	a = atof(argv[1]);
	b = atof(argv[2]);
	erroMaximo = atof(argv[3]);

	valor = calcula_integral(a, b, erroMaximo, 1);
	
	printf("Integral %f \n ", valor);	
	return 0;
}
